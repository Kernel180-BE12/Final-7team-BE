<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.softlabs.aicontents.domain.monitoring.mapper.UnifiedLogMapper">

    <select id="findLogsByConditions" parameterType="map" resultType="LogEntryVO">
        SELECT
        log_id AS logId,
        execution_id AS executionId,
        step_code AS stepCode,
        source_table AS sourceTable,
        source_id AS sourceId,
        business_key AS businessKey,
        log_category AS logCategory,
        log_level AS logLevel,
        status_code AS statusCode,
        log_message AS logMessage,
        created_at AS createdAt
        FROM UNIFIED_LOGS
        WHERE 1 = 1
        <if test="executionId != null">
            AND execution_id = #{executionId}
        </if>
        <if test="startDate != null">
            AND created_at &gt;= #{startDate}
        </if>
        <if test="endDate != null">
            AND created_at &lt;= #{endDate}
        </if>
        <if test="status != null">
            AND status_code = #{status}
        </if>
        <if test="logLevel != null">
            AND log_level = #{logLevel}
        </if>
        ORDER BY created_at ASC
        OFFSET #{offset} ROWS FETCH NEXT #{limit} ROWS ONLY
    </select>

    <select id="countLogsByConditions" parameterType="map" resultType="long">
        SELECT COUNT(*)
        FROM UNIFIED_LOGS
        WHERE 1 = 1
        <if test="executionId != null">
            AND execution_id = #{executionId}
        </if>
        <if test="startDate != null">
            AND created_at &gt;= #{startDate}
        </if>
        <if test="endDate != null">
            AND created_at &lt;= #{endDate}
        </if>
        <if test="status != null">
            AND status_code = #{status}
        </if>
        <if test="logLevel != null">
            AND log_level = #{logLevel}
        </if>
    </select>

</mapper>
